"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateSSRFiles = void 0;
const devkit_1 = require("@nx/devkit");
const semver_1 = require("semver");
const version_utils_1 = require("../../utils/version-utils");
function generateSSRFiles(tree, schema, isUsingApplicationBuilder) {
    const { root: projectRoot, targets } = (0, devkit_1.readProjectConfiguration)(tree, schema.project);
    const baseOutputPath = targets.build.options.outputPath;
    const browserBundleOutputPath = (0, devkit_1.joinPathFragments)(baseOutputPath, 'browser');
    const pathToFiles = (0, devkit_1.joinPathFragments)(__dirname, '..', 'files');
    const { version: angularVersion, major: angularMajorVersion } = (0, version_utils_1.getInstalledAngularVersionInfo)(tree);
    if (schema.standalone) {
        (0, devkit_1.generateFiles)(tree, (0, devkit_1.joinPathFragments)(pathToFiles, 'standalone'), projectRoot, { ...schema, browserBundleOutputPath, tpl: '' });
    }
    else {
        (0, devkit_1.generateFiles)(tree, (0, devkit_1.joinPathFragments)(pathToFiles, 'ngmodule', 'base'), projectRoot, { ...schema, browserBundleOutputPath, tpl: '' });
        if ((0, semver_1.lt)(angularVersion, '15.2.0')) {
            (0, devkit_1.generateFiles)(tree, (0, devkit_1.joinPathFragments)(pathToFiles, 'ngmodule', 'pre-v15-2'), projectRoot, { ...schema, browserBundleOutputPath, tpl: '' });
        }
    }
    (0, devkit_1.generateFiles)(tree, (0, devkit_1.joinPathFragments)(pathToFiles, 'server', ...(isUsingApplicationBuilder
        ? ['application-builder']
        : angularMajorVersion >= 17
            ? ['server-builder', 'v17+']
            : ['server-builder', 'pre-v17'])), projectRoot, { ...schema, browserBundleOutputPath, tpl: '' });
}
exports.generateSSRFiles = generateSSRFiles;
